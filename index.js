(()=>{"use strict";var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{Marginal1D:()=>b,Marginal2D:()=>v,Marginals:()=>p,MarginalsInteractive:()=>y,default:()=>s,get_coords:()=>x,get_rows:()=>O,to_grid:()=>w,to_natural:()=>M});const r=require("react");var n=t.n(r);const a=require("d3");function i(t,e){if(null==t)return{};var r,n,a=function(t,e){if(null==t)return{};var r,n,a={},i=Object.keys(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||(a[r]=t[r]);return a}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(n=0;n<i.length;n++)r=i[n],e.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(t,r)&&(a[r]=t[r])}return a}function o(){return(o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function u(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function l(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?u(Object(r),!0).forEach((function(e){c(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,a=!1,i=void 0;try{for(var o,u=t[Symbol.iterator]();!(n=(o=u.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){a=!0,i=t}finally{try{n||null==u.return||u.return()}finally{if(a)throw i}}return r}}(t,e)||function(t,e){if(t){if("string"==typeof t)return d(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}const s=p;var m=function(t,e){return Array.isArray(t)&&t.length===e&&t.every((function(t,e){return Array.isArray(t)&&t.length===e+1}))};function y(t){var e=t.data,r=t.labels,a=t.svgProps,i=t.bandwidths,u=t.bandwidth,c=n().useMemo((function(){return Array.isArray(e)&&e.length?e[0].length:0}),[e]),d=f(n().useState(m(i,c)?i:Array(c).fill().map((function(t,e){return Array(e+1).fill(u||5)}))),2),s=d[0],y=d[1],h=f(n().useState(void 0),2),g=h[0],M=h[1],w=n().useCallback((function(t){var e=function(t){return"svg"===t.target.nodeName?t.target.attributes.name.nodeValue:t.target.viewportElement?t.target.viewportElement.attributes.name.nodeValue:void 0}(t);e&&M(e)}),[M]),O=g&&g.match(/[0-9]+/g).map((function(t){return parseInt(t)})),x=n().useMemo((function(){if(!O)return null;var t=f(O,2),r=t[0],i=t[1];return r===i?n().createElement(b,o({data:e.map((function(t){return t[r]})),bandwidth:s[r][i]},l({width:100*c,height:100*c,strokeWidth:.5},a||{}))):n().createElement(v,o({data:e.map((function(t){return[t[i],t[r]]})),bandwidth:s[r][i]},l({width:100*c,height:100*c,strokeWidth:.5},a||{})))}),[O,s,e]),j=n().useMemo((function(){if(!O)return null;var t=f(O,2),e=t[0],r=t[1];return n().createElement("input",{placeholder:"bandwidth",value:s[e][r],onChange:function(t){var n=t.target.value;y((function(t){return t.map((function(t,a){return a===e?t.map((function(t,e){return e===r?n:t})):t}))}))}})}),[O,s,y]);return n().createElement("div",null,n().createElement(p,{data:e,labels:r,svgProps:l(l({},a||{}),{},{onClick:w}),bandwidths:s,selection:g}),x,j)}function p(t){var e=t.data,r=t.labels,a=t.svgProps,i=t.bandwidths,u=t.bandwidth,c=t.selection,d=n().useMemo((function(){if(Array.isArray(e)&&e.length){var t=e[0].length;return{d:t,marginals:O(t).map((function(t){return t.map((function(t){var r=f(t,2),n=r[0],a=r[1];return e.map((function(t){return n===a?t[n]:[t[n],t[a]]}))}))}))}}return{d:0}}),[e]),s=d.d,y=d.marginals;if(0===s)return null;var p=Array.isArray(r)&&r.length===s?r:Array(s).fill().map((function(t,e){return"x".concat(e)})),h=m(i,s)?i:Array(s).fill().map((function(t,e){return Array(e+1).fill(u||5)}));return n().createElement("table",null,n().createElement("tbody",null,y.map((function(t,e){return n().createElement("tr",{key:e,name:e},n().createElement("td",null,p[e]),t.map((function(t,r){return n().createElement("td",{key:r},e===r?n().createElement(b,o({data:t,bandwidth:h[e][r],selected:c==="(".concat(e,",").concat(r,")")},l({width:100,height:100,name:"(".concat(e,",").concat(r,")")},a||{}))):n().createElement(v,o({data:t,bandwidth:h[e][r],selected:c==="(".concat(e,",").concat(r,")")},l({width:100,height:100,name:"(".concat(e,",").concat(r,")")},a||{}))))})))})),n().createElement("tr",null,n().createElement("td",null),p.map((function(t,e){return n().createElement("td",{key:e,style:{textAlign:"center"}},t)})))))}var h=n().forwardRef((function(t,e){var r=t.style,a=t.children,u=t.selected,c=i(t,["style","children","selected"]);return n().createElement("svg",o({},c,{style:l({border:u?"1px solid red":"1px solid black"},r||{}),ref:e,viewBox:"0 0 100 100"}),a)}));function b(t){var e=t.data,r=t.bandwidth,o=i(t,["data","bandwidth"]),u=n().useMemo((function(){return g({bandwidth:r||5,stepSize:1})(e)}),[r,e]);return n().createElement(h,o,n().createElement("path",{d:u,fill:"none",stroke:(0,a.interpolateYlGnBu)(1)}))}function v(t){var e=t.data,r=t.bandwidth,u=i(t,["data","bandwidth"]),l=n().useRef();return n().useEffect((function(){var t=e.reduce((function(t,e){var r=f(e,2),n=r[0],a=r[1];return{xMin:Math.min(n,t.xMin),xMax:Math.max(n,t.xMax),yMin:Math.min(a,t.yMin),yMax:Math.max(a,t.yMax)}}),{xMin:1/0,xMax:-1/0,yMin:1/0,yMax:-1/0}),n=t.xMin,i=t.xMax,o=t.yMin,u=t.yMax,c=(0,a.scaleLinear)().domain([n,i]).range([0,100]),d=(0,a.scaleLinear)().domain([o,u]).range([100,0]),s=(0,a.contourDensity)().bandwidth(r||5).x((function(t){return c(t[0])})).y((function(t){return d(t[1])}));(0,a.select)(l.current).selectAll("path").data(s(e)).join("path").attr("fill","none").attr("stroke",(function(t,e,r){return(0,a.interpolateYlGnBu)(1-.75*e/r.length)})).attr("d",(0,a.geoPath)())}),[r,e,l]),n().createElement(h,o({},u,{ref:l}))}var g=function(t){var e=t.bandwidth,r=t.stepSize;return function(t){var n=f(t.reduce((function(t,e){return[Math.min(t[0],e),Math.max(t[1],e)]}),[1/0,-1/0]),2),i=n[0],o=n[1],u=(0,a.scaleLinear)().domain([i,o]).range([0,100]),l=parseInt(100/r),c=Array(l+1).fill().map((function(n,a){var i=u.invert(a*r),o=t.reduce((function(t,r){return t+function(t,e,r){return Math.abs(t-e)<=r?.75*(1-Math.pow((t-e)/r,2))/r:0}(i,r,e)}),0);return[a*r,o]})),d=c.reduce((function(t,e){var r=f(e,2),n=(r[0],r[1]);return Math.max(t,n)}),-1/0),s=(0,a.scaleLinear)().domain([0,d]).range([100,0]);return(0,a.line)().x((function(t){return t[0]})).y((function(t){return s(t[1])}))(c)}};function M(t,e,r){var n=Math.min(t-1,Math.min(e,r)),a=Math.min(t-1,Math.max(e,r));return parseInt(n+a*(a+1)/2)}function w(t,e){for(var r=Math.max(e,0),n=t,a=t,i=0;i<t;i++){var o=parseInt((i+1)*(i+2)/2);if(r<o){n=e-o+i+1,a=i;break}}return[n,a]}function O(t){return Array(t).fill().map((function(t,e){return Array(e+1).fill().map((function(t,r){return[r,e]}))}))}function x(t){return Array(t*(t+1)/2).fill().map((function(e,r){return w(t,r)}))}module.exports=e})();